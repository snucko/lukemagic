---
import Base from "../../layouts/Base.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import { getCollection } from 'astro:content';
const shows = (await getCollection('shows')).sort((a,b)=> (a.data.date > b.data.date ? 1 : -1));
const eventsLd = shows.map(s => ({
  "@context": "https://schema.org",
  "@type": "Event",
  "name": s.data.title,
  "description": s.data.summary,
  "startDate": s.data.date,
  "eventStatus": "https://schema.org/EventScheduled",
  "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
  "location": { "@type": "Place", "name": s.data.venue || "TBA", "address": s.data.city || "" },
  "performer": {
    "@type": "Person",
    "name": "Luke"
  },
  ...(s.data.image && { "image": new URL(s.data.image, Astro.site ?? 'https://lukemagic.tivnan.org').toString() })
}));

const performerLd = {
  "@context": "https://schema.org",
  "@type": "PerformingGroup",
  "name": "Luke — Magic",
  "description": "Professional magician specializing in close-up and street magic",
  "url": Astro.site?.toString() ?? "https://lukemagic.tivnan.org"
};
---
<Base title="Shows — Luke" description="Upcoming magic shows and performances by Luke.">
  <script type="application/ld+json" set:html={JSON.stringify(eventsLd)} />
  <script type="application/ld+json" set:html={JSON.stringify(performerLd)} />
  <Breadcrumbs items={[
    { label: "Home", href: "/" },
    { label: "Shows" }
  ]} />
  <section class="max-w-4xl mx-auto px-6 py-12">
    <h1 class="text-3xl mb-6">Upcoming Shows</h1>
    <ul class="space-y-4">
      {shows.map(s => (
        <li class="p-4 card flex items-center gap-4">
          {s.data.image && <img src={s.data.image} alt={s.data.title} class="w-32 h-32 object-cover rounded-lg" />}
          <div>
            <div class="text-lg">{s.data.title}</div>
            <div class="opacity-80 text-sm">{s.data.date} {s.data.time ? `• ${s.data.time}` : ""} • {s.data.venue ?? ""}{s.data.venue && s.data.city ? ", " : ""}{s.data.city ?? ""}</div>
            {s.data.rsvpUrl && <a class="text-sm" href={s.data.rsvpUrl}>RSVP</a>}
          </div>
        </li>
      ))}
    </ul>
  </section>
</Base>