---
import Base from "../layouts/Base.astro";
import Breadcrumbs from "../components/Breadcrumbs.astro";
import { readdir } from "node:fs/promises";
import { join } from "node:path";

let images: Array<{ src: string; alt: string }> = [];

try {
  const galleryPath = join(process.cwd(), "public", "media", "gallery");
  const files = await readdir(galleryPath);
  images = files
    .filter(file => /\.(png|jpe?g|gif|webp)$/i.test(file))
    .sort()
    .map((file, index) => {
      const row = Math.floor(index / 3) + 1;
      const col = (index % 3) + 1;
      return {
        src: `/media/gallery/${file}`,
        alt: `Luke performing magic - Gallery image ${row}-${col}`
      };
    });
} catch (error) {
  console.warn("Could not load gallery images:", error);
}
---
<Base title="Gallery â€” Luke" description="Photo gallery of Luke's magic performances and show highlights.">
  <Breadcrumbs items={[
    { label: "Home", href: "/" },
    { label: "Gallery" }
  ]} />
  <section class="max-w-6xl mx-auto px-6 py-10">
    <blockquote class="tiktok-embed" cite="https://www.tiktok.com/@cequity/video/7561588816000175415" data-video-id="7561588816000175415" style="max-width: 605px;min-width: 325px;">
      <section>
        <a target="_blank" href="https://www.tiktok.com/@cequity?refer=embed">@cequity</a>
      </section>
    </blockquote>
    <script async src="https://www.tiktok.com/embed.js"></script>
    <h2 class="text-2xl mb-4">Gallery</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
      {images.map((image) => (
        <a href={image.src} target="_blank" rel="noopener" class="block group">
          <img 
            src={image.src} 
            loading="lazy" 
            alt={image.alt} 
            class="rounded-2xl w-full h-auto aspect-square object-cover transition-transform duration-300 group-hover:scale-105" 
          />
        </a>
      ))}
    </div>
  </section>
</Base>